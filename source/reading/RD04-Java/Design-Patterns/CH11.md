---
title: CH11-结构型-代理
search: exclude
---

# CH11-结构型-代理

### 模式动机

某些情况下，一个客户不想或者不能直接引用一个对象，此时可以使用一个称为**代理**的第三者来实现间接引用。代理对象可以在客户端和目标对象之间起到中介作用，并且可以通过代理对象来去掉客户不能看到的内容、服务或资源，或添加额外的功能。

通过引入一个新的对象(小图片、远程代理 对象)来实现对真实对象的操作，或者将新的对象作为真实对象的一个替身，这种实现机制即为代理模式，**通过引入代理对象来间接访问一个对象**。

### 模式定义

**代理模式(Proxy Pattern)**，给某一个对象提供一个代理，并由代理对象控制对源对象的引用。或称为 **Surrogate** 。

### 模式结构

共包含三种角色：

- Subject：抽象主题角色
- Proxy：代理主题角色
- RealSubject：真实主题角色

### 类图

<div  align="center">
<img src="https://infi-img.oss-cn-hangzhou.aliyuncs.com/img/20190220134937.png" style="display:block;width:70%;" alt="NAME" align=center />
</div>

### 时序图

<div  align="center">
<img src="https://infi-img.oss-cn-hangzhou.aliyuncs.com/img/20190220134951.png" style="display:block;width:70%;" alt="NAME" align=center />
</div>

### 优点

- 能够协调调用者和被调用者，一定程度上降低了系统耦合度。
- 远程代理使得客户端可以访问在远程机器上的对象，远程机器可能具有更好的计算性能与处理速度，可以快速响应并处理客户端请求。
- 虚拟代理通过使用一个小对象来代表一个大对象，可以减少系统资源的消耗，优化系统以提升速度。
- 保护代理可以控制真是对象的使用权限。

### 缺点

- 由于在客户端和真实对象之间增加了代理，因此，有些类型的代理模式(如远程)可能会造成请求的处理速度过慢。
- 实现代理模式需要额外的工作，有些实现则比较复杂。

### 适用场景

- 远程代理(Remote)：为一个处于不同地址空间的对象提供一个本地代理对象。
- 虚拟代理(Virtual)：如果需要创建一个资源消耗过大的对象，先创建一个消耗相对较小的对象来表示，真实对象只在需要时在会被真正创建。
- Copy-To-Write 代理：是虚拟代理的一种，把复制(克隆)操作 延迟到只有在客户端真正需要时才执行。对象的深克隆是一个开销较大的工作，此方式可以使该操作延迟，需要时才执行。
- 保护代理(Protect or Access)：控制一个对象的访问，可以给不同的用户提供不同级别的使用权限。
- 缓冲代理(Cache)：为某一个目标操作的结果提供临时的存储空间，以使多个客户端可以共享这些结果。
- 防火墙代理(Firewall)：保护目标不让恶意用户接触。
- 同步化代理(Synchronizaiton)：使几个用户能够同时使用一个对象而没有冲突。
- 智能引用代理(Smart Reference)：当一个对象被引用时，提供一些额外操作，比如记录对象的调用次数。

### 模式应用

EJB、Web Service等分布式技术都是代理模式的应用。

