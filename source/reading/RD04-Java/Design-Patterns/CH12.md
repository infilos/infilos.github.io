---
title: CH12-行为型-命令
search: exclude
---

# CH12-行为型-命令

## 行为型模式概述

**行为型模式(Behavioral Pattern)**是对在不同的对象之间**划分职责和算法**的抽象。

该模式不仅仅关注**类和对象的结构**，而且关注他们之间的**相互作用**。

通过该模式，可以更加清晰地划分类与对象的职责，并研究系统在运行时实例对象之间的交互。在系统运行时，对象并不孤立，他们可以通过相互通信与协作完成某些复杂功能，一个对象在运行时也将影响到其他对象的运行。

该类模式又分为**类行为模式**和**对象行为模式**：

- 类行为模式：使用继承关系在几个子类之间分配行为，通过**多态**方式分配父类与子类的职责。
- 对象行为模式：使用对象的聚合关联关系来分分配行为，主要是通过**对象关联**等方式类分配两个或多个类的职责。根据**合成复用原则**，系统中要尽量通过关联关系来取代继承关系，因此绝大多数的行为设计模式都属于对象行为型模式。

## 命令模式

### 模式动机

 软件设计中，经常要向对象发送请求，但是并不知道对象的接收者是谁，也不知道被请求的操作是哪个，只需要在运行时指定具体的请求接收者即可，此时，可以使用命令模式来进行设计，使得请求发送者和接收者之间接触耦合，增加对象调用之间的灵活性。

命令模式可以对发送者和接收者完全解耦，发送者与接收者之间没有直接引用关系，发送请求的对象只需要知道如何发送请求，而不必知道如何完成请求。这就是命令模式的模式动机。

### 模式定义

**命令模式(Command Pattern)**：将一个请求封装为一个对象，从而使我们可以用不同的请求对客户进行参数化；对请求排队或记录请求日志，以及支持可撤销的操作。属于对象行为型模式，别名为**动作模式(Action)**或**事务模式(Transaction)**。

### 模式结构

包含五种角色：

- Command：抽象命令类
- ConcreteCommand：具体命令类
- Invoker：调用者
- Reciver：接收者
- Client：客户端

### 类图

<div  align="center">
<img src="https://infi-img.oss-cn-hangzhou.aliyuncs.com/img/20190220135025.png" style="display:block;width:70%;" alt="NAME" align=center />
</div>

### 时序图

<div  align="center">
<img src="https://infi-img.oss-cn-hangzhou.aliyuncs.com/img/20190220135038.png" style="display:block;width:70%;" alt="NAME" align=center />
</div>

### 代码示例

### 模式分析

**命令模式的本质是对命令进行封装，将发送命令的责任和执行命令的责任分隔开。**

- 每一个命令都是一个操作：请求方发出请求，要求执行一个操作；接收方收到请求，并执行操作。
- 命令模式运行请求方和接收方独立开来，使得请求方不必知道接收方的接口，更不必知道请求是如何被接收的，以及操作是否被执行、合适被执行，以及如何执行。
- 命令模式使请求本身称为一个对象，这个对象和其他对象一样可以被存储和传递。
- 命令模式的关键在于**引入了抽象命令接口**，并且发送者针对抽象命令接口编程，只有实现了抽象命令接口的具体命令才能与接收者相互关联。

### 优点

- 降低系统的耦合度
- 新的命令可以很容易地加入到系统
- 可以比较容易的设计一个命令队列和宏命令(组合命令)
- 可以方便的实现对请求的 Undo 和 Redo 操作

### 缺点

- 可能会导致某些系统有过多的具体命令类。因为针对每一个命令都需要设计一个具体命令类，因此某些系统可能会需要大量命令类，这将影响命令模式的使用。

### 适用场景

- 系统需要将请求调用者和接收者解耦，使得调用者和接收者不直接交互
- 需要在不同的时间指定请求、将请求排队、执行
- 系统需要支持命令的撤销和恢复操作
- 系统需要将一组操作组合在一起，即自持宏命令

### 模式扩展

- 宏命令又称组合命令，它是命令模式和组合模式联用的产物。
- 宏命令也是一个具体命令，不过他包含了对其他命令对象的引用。在调用宏命令的`execute()`方法时，将会递归调用它所包含的每个成员命令的`execute()`方法。
- 一个宏命令的成员对象可以是一个简单命令也可以是另外一个宏命令。
- 执行一个宏命令将执行多个具体命令，从而实现对命令的批处理。

